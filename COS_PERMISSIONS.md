# COS 存储挂载权限配置指南

## 概述

使用腾讯云对象存储（COS）进行存储挂载时，需要配置相应的访问密钥和权限。

## 权限要求

### 方案一：使用云开发对象存储（推荐）⭐

**无需配置权限**：
- 选择「云开发对象存储」时，系统自动处理所有权限
- 无需手动配置 SecretID 和 SecretKey
- 无需配置访问策略
- **这是最简单的方式，强烈推荐**

### 方案二：使用腾讯云对象存储

如果选择「腾讯云对象存储」，需要配置访问密钥和权限：

#### 1. 权限策略选项

**选项 A：全权限策略（推荐）**
- 策略名称：`QcloudCOSFullAccess`
- 权限范围：COS 全读写访问权限
- 适用场景：开发和测试环境
- 配置步骤：
  1. 登录 [腾讯云访问管理控制台](https://console.cloud.tencent.com/cam)
  2. 进入「用户」→ 选择子用户（或创建新子用户）
  3. 点击「关联策略」
  4. 搜索 `QcloudCOSFullAccess`
  5. 添加该策略

**选项 B：读写权限策略（最小权限）**
- 策略名称：`QcloudCOSReadWrite`
- 权限范围：COS 读写权限
- 适用场景：生产环境（更安全）
- 配置步骤：同上，搜索 `QcloudCOSReadWrite`

**选项 C：自定义策略（细粒度控制）**
- 包含以下操作：
  - `cos:GetBucket` - 获取存储桶信息
  - `cos:PutObject` - 上传对象
  - `cos:GetObject` - 下载对象
  - `cos:DeleteObject` - 删除对象
  - `cos:ListBucket` - 列出对象
  - `cos:HeadBucket` - 检查存储桶是否存在
  - `cos:HeadObject` - 检查对象是否存在

#### 2. 配置访问密钥

1. **创建子用户**（推荐，更安全）：
   - 进入「访问管理」→「用户」→「新建子用户」
   - 选择「编程访问」
   - 创建子用户

2. **为子用户添加权限**：
   - 选择刚创建的子用户
   - 点击「关联策略」
   - 添加 `QcloudCOSFullAccess` 或 `QcloudCOSReadWrite`

3. **获取 SecretID 和 SecretKey**：
   - 在子用户详情页，查看「API 密钥」
   - 记录 SecretID 和 SecretKey

4. **配置到云托管**：
   - 进入云开发控制台
   - 选择「资源连接」→「连接管理」
   - 或在云托管服务的「存储挂载」→「新增连接密钥」
   - 添加腾讯云 API 密钥，填入 SecretID 和 SecretKey

## 权限对比

| 权限策略 | 权限范围 | 安全性 | 推荐场景 |
|---------|---------|--------|---------|
| 云开发对象存储 | 自动处理 | 高 | **所有场景（推荐）** |
| QcloudCOSFullAccess | COS 全权限 | 中 | 开发/测试环境 |
| QcloudCOSReadWrite | COS 读写权限 | 高 | 生产环境 |
| 自定义策略 | 细粒度控制 | 最高 | 特殊需求 |

## 最佳实践

### 1. 使用云开发对象存储（最简单）

- ✅ 无需配置权限
- ✅ 系统自动处理
- ✅ 适合大多数场景

### 2. 如果必须使用腾讯云对象存储

- ✅ 创建专用子用户，不要使用主账号密钥
- ✅ 遵循最小权限原则，只授予必要的权限
- ✅ 定期轮换访问密钥
- ✅ 不要将密钥提交到代码仓库

### 3. 权限配置步骤

1. **创建子用户**：
   ```
   访问管理 → 用户 → 新建子用户 → 编程访问
   ```

2. **添加权限**：
   ```
   选择子用户 → 关联策略 → 搜索 QcloudCOSFullAccess → 添加
   ```

3. **获取密钥**：
   ```
   子用户详情 → API 密钥 → 查看 SecretID 和 SecretKey
   ```

4. **配置到云托管**：
   ```
   云开发控制台 → 资源连接 → 连接管理 → 新增连接密钥
   ```

## 常见问题

### Q1: 使用云开发对象存储还需要配置权限吗？

**A**: 不需要。云开发对象存储会自动处理所有权限，无需手动配置。

### Q2: 权限不足怎么办？

**A**: 
1. 检查子用户是否关联了 COS 相关策略
2. 确认使用的是子用户的 SecretID 和 SecretKey
3. 检查存储桶的地域是否与权限配置一致

### Q3: 可以只给特定存储桶的权限吗？

**A**: 可以。使用自定义策略，在 `resource` 字段中指定具体的存储桶：

```json
{
  "resource": [
    "qcs::cos:ap-shanghai:uid/123456789:bucket/your-bucket-name/*"
  ]
}
```

### Q4: 主账号密钥可以直接用吗？

**A**: 不推荐。建议创建子用户并授予最小权限，更安全。

## 参考文档

- [腾讯云访问管理文档](https://cloud.tencent.com/document/product/598)
- [COS 权限说明](https://cloud.tencent.com/document/product/436/12469)
- [存储挂载文档](https://docs.cloudbase.net/run/deploy/configuring/storage/cos)

